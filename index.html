<html>
<head><title>
    Stop and ...
</title></head>    
<body style='margin: 0; height:100vh; width: 100vw; overflow: hidden'>
<div id='nomouse' style='float: right; clear: none;'>Click to drag the nose! Turn on audio to enjoy!</div>
<img id="rose" style="position: absolute; user-drag: none; top: calc(35%); left: calc(40%); width: 30%; height: auto; image-rendering: pixelated;" src="./rose.png"></img>
<img id="nose" style="z-index: 2; position: absolute; user-drag: none; width: 20%; height: auto; image-rendering: pixelated;" src="./nose.png"></img>

<script>
const synth = window.speechSynthesis;
let lastUtterance = 'Pleasant';
dragElement = elem => {
    console.log("DRAG ELEMENT");
    let x0 = 0;
    let y0 = 0;
    let x1 = 0;
    let y1 = 0;

    let utteranceDone = true;

    dragMouseDown = e => {
        // e.preventDefault();

        if(document.getElementById('nomouse')) {
            document.getElementById('nomouse').remove();
        }

        x1 = e.clientX;
        y1 = e.clientY;

        document.onmouseup = closeDragElem;
        document.onmousemove = elementDrag;
        document.ontouchend = closeDragElem;
        document.ontouchmove = elementDrag;
    }

    elementDrag = e => {
        // e.preventDefault();
        console.log('beep');
        let eT = e.touches ? e.touches[0] : e;

        x0 = x1 - eT.clientX;
        y0 = y1 - eT.clientY;
        x1 = eT.clientX;
        y1 = eT.clientY;

        elem.style.top = (elem.offsetTop - y0) + "px";
        elem.style.left = (elem.offsetLeft - x0) + "px";

        const r = document.getElementById('rose').getBoundingClientRect();
        const n = document.getElementById('nose').getBoundingClientRect();

        const utter = (
                n.left < r.right
                && r.left < n.right
                && n.top < r.bottom
                && r.top < n.bottom
                )
                ? "Pleasant"
                : "Nonplussed";

        if(utteranceDone && lastUtterance !== utter) {
            utteranceDone = false;
            const req = new SpeechSynthesisUtterance(utter);
            req.voice = synth.getVoices()[0];

            const xmlns = "http://www.w3.org/2000/svg";

            blinker = document.createElementNS(xmlns, 'svg');
            blinker.setAttributeNS(null, 'viewBox', `0 ${utter === 'Pleasant' ? -33 : -35} ${utter === 'Pleasant' ? 60 : 78} 40`);
            blinker.setAttributeNS(null, 'width', '100');
            blinker.setAttributeNS(null, 'height', '100');
            blinker.style.width = '100%';
            blinker.style.height = '100%';
            blinker.style.position = 'fixed';
            blinker.style.pointerEvents = 'none';
            blinker.style.zIndex = '0';
            blinker.style.filter = 'drop-shadow(15px 15px 25px black)';

            g = document.createElementNS(xmlns, 'g');
            blinker.appendChild(g);
            // <rect x="500" y="100" width="50" height="50" fill="#393" />

            // blinkerBackground = document.createElementNS(xmlns, 'rect');
            // blinkerBackground.setAttributeNS(null, 'width', '50');
            // blinkerBackground.setAttributeNS(null, 'height', '50');

            // blinkerBackground.setAttribute('x', '0');
            // blinkerBackground.setAttribute('y', '0');

            // blinkerBackground.setAttribute('fill', 'fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)');
            // g.appendChild(blinkerBackground);

            blinkerText = document.createElementNS(xmlns, 'text');
            // blinkerText.setAttributeNS(null, 'x', '0');
            // blinkerText.setAttributeNS(null, 'y', '15');
            blinkerText.style.fontSize='13px';
            blinkerText.style.fontFamily='"Courier New", Courier, monospace';
            blinkerText.style.fill='#000000';
            // blinkerText.style.stroke='#FFFFFF';
            // blinkerText.style.strokeWidth='.25px';

            g.appendChild(blinkerText);
            blinkerText.textContent = utter;
            document.body.appendChild(blinker);

            req.onend = () => {
                document.body.removeChild(blinker);
                utteranceDone = true;
                };
            lastUtterance = utter;
            synth.speak(req);
        }
    }

    closeDragElem = () => {
        document.onmouseup = null;
        document.onmousemove = null;
        document.ontouchend = null;
        document.ontouchmove = null;
    }
    elem.onmousedown = dragMouseDown;
    elem.ontouchstart = dragMouseDown;
}
dragElement(document.getElementById('nose'));
</script></body></html>